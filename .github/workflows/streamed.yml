name: ğŸ”„ Generate StreamedSU Playlist âš¡

on:
  schedule:
    - cron: '0 * * * *' # â° Runs every hour on the hour
  workflow_dispatch: # ğŸŸ¢ Allows manual runs from the GitHub UI

permissions:
  contents: write # âœï¸ Grants permission to write to the repository

jobs:
  scrape:
    runs-on: ubuntu-latest # ğŸ§ Uses a clean Ubuntu environment

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0 # Fetches full history for proper git checks

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11' # ğŸ Matches your local Python target

      - name: Install dependencies & Playwright
        run: |
          python -m pip install --upgrade pip
          pip install playwright requests
          playwright install firefox        # ğŸŒ Install the Firefox browser for Playwright
          playwright install-deps           # ğŸ”§ System deps for headless browser

      - name: Run StreamedSU Scraper
        run: |
          echo "ğŸš€ Starting StreamedSU scrape..."
          python streamed.py
          echo "âœ… Scrape complete, output saved to StreamedSU.m3u8"

      - name: Commit and Push updated playlist
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add StreamedSU.m3u8
          git commit -m "ğŸ§© Update StreamedSU Playlist âš¡ $(date '+%Y-%m-%d %H:%M:%S')" || echo "No changes to commit"
          git push
